name: Pre-release for llama-index

on:
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  prepare-release:
    if: github.repository == 'run-llama/llama_index'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5

      - name: Install uv and set python version
        uses: astral-sh/setup-uv@v6
        with:
          python-version: "3.10"

      - name: Prepare
        shell: bash
        working-directory: llama-dev
        run: |
          uv run -- llama-dev --repo-root .. release prepare
          uv run -- llama-dev --repo-root .. release changelog

      - name: Create Release PR
        id: rpr
        uses: peter-evans/create-pull-request@v7
        with:
          commit-message: Prepare release
          signoff: false
          branch: pre-release
          delete-branch: true
          title: "Prepare release"
          draft: false
